{"version":3,"sources":["akiroz/re_frame/storage.cljs"],"mappings":"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","names":["cljs.spec.alpha/def-impl","cljs.spec.alpha/or-spec-impl","cljs.core/nil?","cljs.core/boolean?","cljs.core/number?","cljs.core/string?","cljs.core/keyword?","cljs.core/symbol?","cljs.core/uuid?","cljs.core.partial.cljs$core$IFn$_invoke$arity$2","cljs.core/instance?","js/Date","cljs.spec.alpha.every_impl.cljs$core$IFn$_invoke$arity$4","G__41946","cljs.core/list?","G__41947","cljs.core/vector?","G__41948","cljs.core/set?","cljs.spec.alpha.tuple_impl.cljs$core$IFn$_invoke$arity$2","G__41949","cljs.core/map?","i__13009__auto__","v__13010__auto__","cljs.core.nth.cljs$core$IFn$_invoke$arity$2","akiroz.re-frame.storage/storage-atoms","cljs.core.atom.cljs$core$IFn$_invoke$arity$1","akiroz.re-frame.storage/register-store","store-key","fexpr__41950","cljs.core/deref","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$4","cljs.core/assoc","alandipert.storage-atom/local-storage","cljs.spec.alpha/fspec-impl","cljs.spec.alpha.spec_impl.cljs$core$IFn$_invoke$arity$4","cljs.core/any?","cljs.spec.alpha/cat-impl","akiroz.re-frame.storage/->store","data","cljs.core/reset!","fexpr__41951","akiroz.re-frame.storage/<-store","fexpr__41952","p__41953","map__41954","cljs.core/PROTOCOL_SENTINEL","cljs.core.apply.cljs$core$IFn$_invoke$arity$2","cljs.core/hash-map","cljs.core.get.cljs$core$IFn$_invoke$arity$2","akiroz.re-frame.storage/reg-co-fx!","fx","cofx","G__41956","G__41957","re-frame.core/reg-fx","G__41958","G__41959","re-frame.core/reg-cofx","coeffects","_","cljs.core.assoc.cljs$core$IFn$_invoke$arity$3","cljs.spec.alpha/map-spec-impl","G__41960","cljs.core/contains?","akiroz.re-frame.storage/persist-db","db-key","G__41961","G__41962","G__41963","G__41964","G__41965","G__41966","re-frame.core/->interceptor","cljs.core.keyword.cljs$core$IFn$_invoke$arity$1","context","cljs.core/assoc-in","temp__5735__auto__","value","cljs.core.get_in.cljs$core$IFn$_invoke$arity$2","akiroz.re-frame.storage/persist-db-keys","db-keys","G__41967","G__41968","G__41969","G__41970","G__41971","G__41972","cljs.core/str","cljs.core.sort.cljs$core$IFn$_invoke$arity$1","cljs.core.update_in.cljs$core$IFn$_invoke$arity$4","cljs.core/merge","G__41973","cljs.core/select-keys","G__41974","cljs.core/coll?"],"sourcesContent":["(ns akiroz.re-frame.storage\n  (:require [re-frame.core :refer [reg-fx reg-cofx ->interceptor]]\n            [alandipert.storage-atom :refer [local-storage]]\n            [cljs.spec.alpha :as s]\n            ))\n\n(s/def ::cljs-data\n  (s/or :nil      nil?\n        :boolean  boolean?\n        :number   number?\n        :string   string?\n        :keyword  keyword?\n        :symbol   symbol?\n        :uuid     uuid?\n        :date     (partial instance? js/Date)\n        :list     (s/coll-of  ::cljs-data :kind list?)\n        :vector   (s/coll-of  ::cljs-data :kind vector?)\n        :set      (s/coll-of  ::cljs-data :kind set?)\n        :map      (s/map-of   ::cljs-data ::cljs-data)\n        ))\n\n\n;; atom containing local-storage atoms\n(def storage-atoms (atom {}))\n\n\n(defn register-store [store-key]\n  (when-not (@storage-atoms store-key)\n    (swap! storage-atoms assoc store-key\n           (local-storage (atom nil) store-key))))\n\n(s/fdef register-store\n  :args (s/cat :store-key keyword?))\n\n\n(defn ->store [store-key data]\n  (reset! (@storage-atoms store-key) data))\n\n(s/fdef ->store\n  :args (s/cat :store-key keyword?\n               :data ::cljs-data))\n\n\n(defn <-store [store-key]\n  @(@storage-atoms store-key))\n\n(s/fdef <-store\n  :args (s/cat :store-key keyword?)\n  :ret  ::cljs-data)\n\n\n\n\n(defn reg-co-fx! [store-key {:keys [fx cofx]}]\n  (register-store store-key)\n  (when fx\n    (reg-fx\n      fx\n      (fn [data]\n        (->store store-key data))))\n  (when cofx\n    (reg-cofx\n      cofx\n      (fn [coeffects _]\n        (assoc coeffects cofx (<-store store-key))))))\n\n(s/def ::fx keyword?)\n(s/def ::cofx keyword?)\n(s/fdef reg-co-fx!\n  :args (s/cat :store-key keyword?\n               :handlers (s/keys :req-un [(or ::fx ::cofx)])))\n\n\n(defn persist-db [store-key db-key]\n  (register-store store-key)\n  (->interceptor\n    :id (keyword (str db-key \"->\" store-key))\n    :before (fn [context]\n              (assoc-in context [:coeffects :db db-key]\n                        (<-store store-key)))\n    :after (fn [context]\n             (when-let [value (get-in context [:effects :db db-key])]\n               (->store store-key value))\n             context)))\n\n(s/fdef persist-db\n  :args (s/cat :store-key keyword?\n               :db-key keyword?))\n\n\n(defn persist-db-keys [store-key db-keys]\n  (register-store store-key)\n  (->interceptor\n    :id (keyword (str (apply str (sort db-keys)) \"->\" store-key))\n    :before (fn [context]\n              (update-in context [:coeffects :db] merge (<-store store-key)))\n    :after (fn [context]\n             (when-let [value (some-> (get-in context [:effects :db])\n                                      (select-keys db-keys))]\n               (->store store-key value))\n             context)))\n\n(s/fdef persist-db-keys\n  :args (s/cat :store-key keyword?\n               :db-keys (s/coll-of keyword?)))\n\n\n"]}